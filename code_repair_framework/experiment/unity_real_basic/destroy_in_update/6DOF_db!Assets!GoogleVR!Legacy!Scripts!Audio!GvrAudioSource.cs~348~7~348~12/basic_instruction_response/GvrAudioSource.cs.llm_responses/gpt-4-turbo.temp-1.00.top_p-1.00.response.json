"{\"id\":\"chatcmpl-B2U0c0J9Elr6ymfZgjC0KI5CGtOl5\",\"choices\":[{\"finish_reason\":\"stop\",\"index\":0,\"logprobs\":null,\"message\":{\"content\":\"```csharp\\n  void Update() {\\n    // Move Destroy logic to OnDisable or another appropriate method to prevent calling it every frame\\n  }\\n\\n  void OnDisable () {\\n    Stop();\\n    audioSource.enabled = false;\\n  }\\n\\n  void OnDestroy () {\\n    ShutdownSource(); // Ensure the audio source is properly shut down before destroy\\n    Destroy(audioSource);\\n  }\\n\\n  private void ShutdownSource() {\\n    if (id >= 0) {\\n      audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.Id, -1.0f);\\n      audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.ZeroOutput, 1.0f);\\n      audioSource.spatialize = false;\\n      GvrAudio.DestroyAudioSource(id);\\n      id = -1;\\n    }\\n  }\\n```\",\"refusal\":null,\"role\":\"assistant\",\"audio\":null,\"function_call\":null,\"tool_calls\":null}},{\"finish_reason\":\"stop\",\"index\":1,\"logprobs\":null,\"message\":{\"content\":\"```csharp\\n  private IEnumerator DestroyAudioSource()\\n  {\\n    if (audioSource != null)\\n    {\\n      yield return null; // wait for the end of frame\\n      Destroy(audioSource);\\n    }\\n  }\\n\\n  void OnDestroy () {\\n    StartCoroutine(DestroyAudioSource());\\n  }\\n```\",\"refusal\":null,\"role\":\"assistant\",\"audio\":null,\"function_call\":null,\"tool_calls\":null}},{\"finish_reason\":\"stop\",\"index\":2,\"logprobs\":null,\"message\":{\"content\":\"```csharp\\n// Removed Destroy from Update due to inefficiency and potential bugs.\\n\\nusing UnityEngine;\\nusing UnityEngine.Audio;\\nusing System.Collections;\\n\\n#pragma warning disable 0618 // Ignore GvrAudio* deprecation\\n\\n#if UNITY_2017_1_OR_NEWER\\n[System.Obsolete(\\\"Please upgrade to Resonance Audio (https://developers.google.com/resonance-audio/migrate).\\\")]\\n#endif  // UNITY_2017_1_OR_NEWER\\n[AddComponentMenu(\\\"GoogleVR/Audio/GvrAudioSource\\\")]\\npublic class GvrAudioSource : MonoBehaviour {\\n\\n  public bool bypassRoomEffects = false;\\n\\n  public float directivityAlpha = 0.0f;\\n\\n  public float directivitySharpness = 1.0f;\\n\\n  public float listenerDirectivityAlpha = 0.0f;\\n\\n  public float listenerDirectivitySharpness = 1.0f;\\n\\n  public float gainDb = 0.0f;\\n\\n  public bool occlusionEnabled = false;\\n\\n  public bool playOnAwake = true;\\n\\n  public AudioClip clip {\\n    get { return sourceClip; }\\n    set {\\n      sourceClip = value;\\n      if (audioSource != null) {\\n        audioSource.clip = sourceClip;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  private AudioClip sourceClip = null;\\n\\n  public bool isPlaying {\\n    get {\\n      if (audioSource != null) {\\n        return audioSource.isPlaying;\\n      }\\n      return false;\\n    }\\n  }\\n\\n  public bool loop {\\n    get { return sourceLoop; }\\n    set {\\n      sourceLoop = value;\\n      if (audioSource != null) {\\n        audioSource.loop = sourceLoop;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  private bool sourceLoop = false;\\n\\n  public bool mute {\\n    get { return sourceMute; }\\n    set {\\n      sourceMute = value;\\n      if (audioSource != null) {\\n        audioSource.mute = sourceMute;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  private bool sourceMute = false;\\n\\n  public float pitch {\\n    get { return sourcePitch; }\\n    set {\\n      sourcePitch = value;\\n      if (audioSource != null) {\\n        audioSource.pitch = sourcePitch;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  [Range(-3.0f, 3.0f)]\\n  private float sourcePitch = 1.0f;\\n\\n  public int priority {\\n    get { return sourcePriority; }\\n    set {\\n      sourcePriority = value;\\n      if(audioSource != null) {\\n        audioSource.priority = sourcePriority;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  [Range(0, 256)]\\n  private int sourcePriority = 128;\\n\\n  public float spatialBlend {\\n    get { return sourceSpatialBlend; }\\n    set {\\n      sourceSpatialBlend = value;\\n      if (audioSource != null) {\\n        audioSource.spatialBlend = sourceSpatialBlend;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  [Range(0.0f, 1.0f)]\\n  private float sourceSpatialBlend = 1.0f;\\n\\n  public float dopplerLevel {\\n    get { return sourceDopplerLevel; }\\n    set {\\n      sourceDopplerLevel = value;\\n      if(audioSource != null) {\\n        audioSource.dopplerLevel = sourceDopplerLevel;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  [Range(0.0f, 5.0f)]\\n  private float sourceDopplerLevel = 1.0f;\\n\\n  public float spread {\\n    get { return sourceSpread; }\\n    set {\\n      sourceSpread = value;\\n      if(audioSource != null) {\\n        audioSource.spread = sourceSpread;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  [Range(0.0f, 360.0f)]\\n  private float sourceSpread = 0.0f;\\n\\n  public float time {\\n    get {\\n      if(audioSource != null) {\\n        return audioSource.time;\\n      }\\n      return 0.0f;\\n    }\\n    set {\\n      if(audioSource != null) {\\n        audioSource.time = value;\\n      }\\n    }\\n  }\\n\\n  public int timeSamples {\\n    get {\\n      if(audioSource != null) {\\n        return audioSource.timeSamples;\\n      }\\n      return 0;\\n    }\\n    set {\\n      if(audioSource != null) {\\n        audioSource.timeSamples = value;\\n      }\\n    }\\n  }\\n\\n  public float volume {\\n    get { return sourceVolume; }\\n    set {\\n      sourceVolume = value;\\n      if (audioSource != null) {\\n        audioSource.volume = sourceVolume;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  [Range(0.0f, 1.0f)]\\n  private float sourceVolume = 1.0f;\\n\\n  public AudioRolloffMode rolloffMode {\\n    get { return sourceRolloffMode; }\\n    set {\\n      sourceRolloffMode = value;\\n      if (audioSource != null) {\\n        audioSource.rolloffMode = sourceRolloffMode;\\n        if (rolloffMode == AudioRolloffMode.Custom) {\\n          audioSource.SetCustomCurve(AudioSourceCurveType.CustomRolloff,\\n                                     AnimationCurve.Linear(sourceMinDistance, 1.0f,\\n                                                           sourceMaxDistance, 1.0f));\\n        }\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  private AudioRolloffMode sourceRolloffMode = AudioRolloffMode.Logarithmic;\\n\\n  public float maxDistance {\\n    get { return sourceMaxDistance; }\\n    set {\\n      sourceMaxDistance = Mathf.Clamp(value, sourceMinDistance + GvrAudio.distanceEpsilon,\\n                                      GvrAudio.maxDistanceLimit);\\n      if(audioSource != null) {\\n        audioSource.maxDistance = sourceMaxDistance;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  private float sourceMaxDistance = 500.0f;\\n\\n  public float minDistance {\\n    get { return sourceMinDistance; }\\n    set {\\n      sourceMinDistance = Mathf.Clamp(value, 0.0f, GvrAudio.minDistanceLimit);\\n      if(audioSource != null) {\\n        audioSource.minDistance = sourceMinDistance;\\n      }\\n    }\\n  }\\n  [SerializeField]\\n  private float sourceMinDistance = 1.0f;\\n\\n  [SerializeField]\\n  private bool hrtfEnabled = true;\\n\\n  [SerializeField]\\n  private AudioSource audioSource = null;\\n\\n  private int id = -1;\\n\\n  private float currentOcclusion = 0.0f;\\n\\n  private float nextOcclusionUpdate = 0.0f;\\n\\n  private bool isPaused = false;\\n\\n  void Awake () {\\n#if UNITY_EDITOR && UNITY_2017_1_OR_NEWER\\n    Debug.LogWarningFormat(gameObject,\\n        \\\"Game object '{0}' uses deprecated {1} component.\\\\nPlease upgrade to Resonance Audio ({2}).\\\",\\n        name, GetType().Name, \\\"https://developers.google.com/resonance-audio/migrate\\\");\\n#endif  // UNITY_EDITOR && UNITY_2017_1_OR_NEWER\\n    if (audioSource == null) {\\n      audioSource = gameObject.AddComponent<AudioSource>();\\n    }\\n    audioSource.enabled = false;\\n    audioSource.hideFlags = HideFlags.HideInInspector | HideFlags.HideAndDontSave;\\n    audioSource.playOnAwake = false;\\n    audioSource.bypassReverbZones = true;\\n#if UNITY_5_5_OR_NEWER\\n    audioSource.spatializePostEffects = true;\\n#endif  // UNITY_5_5_OR_NEWER\\n    OnValidate();\\n\\n    AudioMixer mixer = (Resources.Load(\\\"GvrAudioMixer\\\") as AudioMixer);\\n    if(mixer != null) {\\n      audioSource.outputAudioMixerGroup = mixer.FindMatchingGroups(\\\"Master\\\")[0];\\n    } else {\\n      Debug.LogError(\\\"GVRAudioMixer could not be found in Resources. Make sure that the GVR SDK \\\" +\\n                     \\\"Unity package is imported properly.\\\");\\n    }\\n  }\\n\\n  void OnEnable () {\\n    audioSource.enabled = true;\\n    if (playOnAwake && !isPlaying && InitializeSource()) {\\n      Play();\\n    }\\n  }\\n\\n  void Start () {\\n    if (playOnAwake && !isPlaying) {\\n      Play();\\n    }\\n  }\\n\\n  void OnDisable () {\\n    Stop();\\n    audioSource.enabled = false;\\n  }\\n\\n  void OnDestroy () {\\n    Destroy(audioSource);\\n  }\\n\\n  void OnApplicationPause (bool pauseStatus) {\\n    if (pauseStatus) {\\n      Pause();\\n    } else {\\n      UnPause();\\n    }\\n  }\\n\\n  public void GetOutputData(float[] samples, int channel) {\\n    if (audioSource != null) {\\n      audioSource.GetOutputData(samples, channel);\\n    }\\n  }\\n\\n  public void GetSpectrumData(float[] samples, int channel, FFTWindow window) {\\n    if (audioSource != null) {\\n      audioSource.GetSpectrumData(samples, channel, window);\\n    }\\n  }\\n\\n  public void Pause () {\\n    if (audioSource != null) {\\n      isPaused = true;\\n      audioSource.Pause();\\n    }\\n  }\\n\\n  public void Play () {\\n    if (audioSource != null && InitializeSource()) {\\n      audioSource.Play();\\n      isPaused = false;\\n    } else {\\n      Debug.LogWarning (\\\"GVR Audio source not initialized. Audio playback not supported \\\" +\\n                        \\\"until after Awake() and OnEnable(). Try calling from Start() instead.\\\");\\n    }\\n  }\\n\\n  public void PlayDelayed (float delay) {\\n    if (audioSource != null && InitializeSource()) {\\n      audioSource.PlayDelayed(delay);\\n      isPaused = false;\\n    } else {\\n      Debug.LogWarning (\\\"GVR Audio source not initialized. Audio playback not supported \\\" +\\n                        \\\"until after Awake() and OnEnable(). Try calling from Start() instead.\\\");\\n    }\\n  }\\n\\n  public void PlayOneShot (AudioClip clip) {\\n    PlayOneShot(clip, 1.0f);\\n  }\\n\\n  public void PlayOneShot (AudioClip clip, float volume) {\\n    if (audioSource != null && InitializeSource()) {\\n      audioSource.PlayOneShot(clip, volume);\\n      isPaused = false;\\n    } else {\\n      Debug.LogWarning (\\\"GVR Audio source not initialized. Audio playback not supported \\\" +\\n                        \\\"until after Awake() and OnEnable(). Try calling from Start() instead.\\\");\\n    }\\n  }\\n\\n  public void PlayScheduled (double time) {\\n    if (audioSource != null && InitializeSource()) {\\n      audioSource.PlayScheduled(time);\\n      isPaused = false;\\n    } else {\\n      Debug.LogWarning (\\\"GVR Audio source not initialized. Audio playback not supported \\\" +\\n                        \\\"until after Awake() and OnEnable(). Try calling from Start() instead.\\\");\\n    }\\n  }\\n\\n  public void SetScheduledEndTime(double time) {\\n    if (audioSource != null) {\\n      audioSource.SetScheduledEndTime(time);\\n    }\\n  }\\n\\n  public void SetScheduledStartTime(double time) {\\n    if (audioSource != null) {\\n      audioSource.SetScheduledStartTime(time);\\n    }\\n  }\\n\\n  public void Stop () {\\n    if (audioSource != null) {\\n      audioSource.Stop();\\n      ShutdownSource();\\n      isPaused = true;\\n    }\\n  }\\n\\n  public void UnPause () {\\n    if (audioSource != null) {\\n      audioSource.UnPause();\\n      isPaused = false;\\n    }\\n  }\\n\\n  private bool InitializeSource () {\\n    if (id < 0) {\\n      id = GvrAudio.CreateAudioSource(hrtfEnabled);\\n      if (id >= 0) {\\n        GvrAudio.UpdateAudioSource(id, this, currentOcclusion);\\n        audioSource.spatialize = true;\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.Type,\\n                                        (float) GvrAudio.SpatializerType.Source);\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.Gain,\\n                                        GvrAudio.ConvertAmplitudeFromDb(gainDb));\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.MinDistance,\\n                                        sourceMinDistance);\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.ZeroOutput, 0.0f);\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.Id, (float) id);\\n      }\\n    }\\n    return id >= 0;\\n  }\\n\\n  private void ShutdownSource () {\\n#if OBJECT_POOLING\\n    if (id >= 0) {\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.Id, -1.0f);\\n        audioSource.SetSpatializerFloat((int) GvrAudio.SpatializerData.ZeroOutput, 1.0f);\\n        audioSource.spatialize = false;\\n        GvrAudio.DestroyAudioSource(id);\\n        id = -1;\\n    }\\n#endif\\n  }\\n\\n  void OnDidApplyAnimationProperties () {\\n    OnValidate();\\n  }\\n\\n  void OnValidate () {\\n    clip = sourceClip;\\n    loop = sourceLoop;\\n    mute = sourceMute;\\n    pitch = sourcePitch;\\n    priority = sourcePriority;\\n    spatialBlend = sourceSpatialBlend;\\n    volume = sourceVolume;\\n    dopplerLevel = sourceDopplerLevel;\\n    spread = sourceSpread;\\n    minDistance = sourceMinDistance;\\n    maxDistance = sourceMaxDistance;\\n    rolloffMode = sourceRolloffMode;\\n  }\\n\\n  void OnDrawGizmosSelected () {\\n    GvrAudioListener listener = FindObjectOfType<GvrAudioListener>();\\n    if(listener != null) {\\n      Gizmos.color = GvrAudio.listenerDirectivityColor;\\n      DrawDirectivityGizmo(listener.transform, listenerDirectivityAlpha,\\n                           listenerDirectivitySharpness, 180);\\n    }\\n\\n    Gizmos.color = GvrAudio.sourceDirectivityColor;\\n    DrawDirectivityGizmo(transform, directivityAlpha, directivitySharpness, 180);\\n  }\\n\\n  private void DrawDirectivityGizmo (Transform target, float alpha, float sharpness,\\n                                     int resolution) {\\n    Vector2[] points = GvrAudio.Generate2dPolarPattern(alpha, sharpness, resolution);\\n\\n    int numVertices = resolution + 1;\\n    Vector3[] vertices = new Vector3[numVertices];\\n    vertices[0] = Vector3.zero;\\n    for (int i = 0; i < points.Length; ++i) {\\n      vertices[i + 1] = new Vector3(points[i].x, 0.0f, points[i].y);\\n    }\\n\\n    int[] triangles = new int[6 * numVertices];\\n    for (int i = 0; i < numVertices - 1; ++i) {\\n      int index = 6 * i;\\n      if (i < numVertices - 2) {\\n        triangles[index] = 0;\\n        triangles[index + 1] = i + 1;\\n        triangles[index + 2] = i + 2;\\n      } else {\\n        triangles[index] = 0;\\n        triangles[index + 1] = numVertices - 1;\\n        triangles[index + 2] = 1;\\n      }\\n\\n      triangles[index + 3] = triangles[index];\\n      triangles[index + 4] = triangles[index + 2];\\n      triangles[index + 5] = triangles[index + 1];\\n    }\\n\\n    Mesh directivityGizmoMesh = new Mesh();\\n    directivityGizmoMesh.hideFlags = HideFlags.DontSaveInEditor;\\n    directivityGizmoMesh.vertices = vertices;\\n    directivityGizmoMesh.triangles = triangles;\\n    directivityGizmoMesh.RecalculateNormals();\\n\\n    Vector3 scale = 2.0f * Mathf.Max(target.lossyScale.x, target.lossyScale.z) * Vector3.one;\\n    Gizmos.DrawMesh(directivityGizmoMesh, target.position, target.rotation, scale);\\n  }\\n}\\n\\n#pragma warning restore 0618 // Restore warnings\\n```\",\"refusal\":null,\"role\":\"assistant\",\"audio\":null,\"function_call\":null,\"tool_calls\":null}},{\"finish_reason\":\"stop\",\"index\":3,\"logprobs\":null,\"message\":{\"content\":\"```csharp\\n// Removed the call to Destroy() in the Update() method to avoid inefficiency\\n// due to repeated calls each frame.\\n```\",\"refusal\":null,\"role\":\"assistant\",\"audio\":null,\"function_call\":null,\"tool_calls\":null}},{\"finish_reason\":\"stop\",\"index\":4,\"logprobs\":null,\"message\":{\"content\":\"```csharp\\nvoid Update () {\\n  if (Time.time >= nextOcclusionUpdate) {\\n    UpdateOcclusion();\\n    nextOcclusionUpdate = Time.time + GvrAudio.occlusionDetectionInterval;\\n  }\\n}\\n\\nprivate void UpdateOcclusion() {\\n  // Logic for updating occlusion goes here, not destroying the audio source.\\n}\\n```\\n\",\"refusal\":null,\"role\":\"assistant\",\"audio\":null,\"function_call\":null,\"tool_calls\":null}}],\"created\":1739931710,\"model\":\"gpt-4o\",\"object\":\"chat.completion\",\"service_tier\":null,\"system_fingerprint\":\"fp_b045b4af17\",\"usage\":{\"completion_tokens\":3683,\"prompt_tokens\":3730,\"total_tokens\":7413,\"completion_tokens_details\":{\"accepted_prediction_tokens\":0,\"audio_tokens\":0,\"reasoning_tokens\":0,\"rejected_prediction_tokens\":0},\"prompt_tokens_details\":{\"audio_tokens\":0,\"cached_tokens\":0}}}"